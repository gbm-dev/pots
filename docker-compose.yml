services:
  oob-hub:
    build:
      context: .
      network: host
      args:
        DMODEM_SOURCE: ${DMODEM_SOURCE:-build}
        DMODEM_REF: ${DMODEM_REF:-59cacd766de7e093c9ef2109f146f417f2b6a945}
        DMODEM_MAKE_FLAGS: ${DMODEM_MAKE_FLAGS:-NO_PULSE=1}
    container_name: oob-console-hub
    restart: unless-stopped
    env_file:
      - .env
    # Host networking eliminates SIP NAT issues
    network_mode: host
    volumes:
      # Session logs persist on host
      - ./logs:/var/log/oob-sessions
      # Site config can be edited without rebuild
      - ./config/oob-sites.conf:/etc/oob-sites.conf:ro
      # User accounts persist across container rebuilds
      - oob-userdata:/data/users
    cap_add:
      - SYS_ADMIN

volumes:
  oob-userdata:
